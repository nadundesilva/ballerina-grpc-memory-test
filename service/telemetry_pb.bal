import ballerina/grpc;
import ballerina/protobuf.types.empty;

public isolated client class TelemetryClient {
    *grpc:AbstractClientEndpoint;

    private final grpc:Client grpcClient;

    public isolated function init(string url, *grpc:ClientConfiguration config) returns grpc:Error? {
        self.grpcClient = check new (url, config);
        check self.grpcClient.initStub(self, ROOT_DESCRIPTOR_TELEMETRY, getDescriptorMapTelemetry());
    }

    isolated remote function publishMetrics(MetricsPublishRequest|ContextMetricsPublishRequest req) returns grpc:Error? {
        map<string|string[]> headers = {};
        MetricsPublishRequest message;
        if req is ContextMetricsPublishRequest {
            message = req.content;
            headers = req.headers;
        } else {
            message = req;
        }
        _ = check self.grpcClient->executeSimpleRPC("v0_2_0.Telemetry/publishMetrics", message, headers);
    }

    isolated remote function publishMetricsContext(MetricsPublishRequest|ContextMetricsPublishRequest req) returns empty:ContextNil|grpc:Error {
        map<string|string[]> headers = {};
        MetricsPublishRequest message;
        if req is ContextMetricsPublishRequest {
            message = req.content;
            headers = req.headers;
        } else {
            message = req;
        }
        var payload = check self.grpcClient->executeSimpleRPC("v0_2_0.Telemetry/publishMetrics", message, headers);
        [anydata, map<string|string[]>] [_, respHeaders] = payload;
        return {headers: respHeaders};
    }

    isolated remote function publishTraces(TracesPublishRequest|ContextTracesPublishRequest req) returns grpc:Error? {
        map<string|string[]> headers = {};
        TracesPublishRequest message;
        if req is ContextTracesPublishRequest {
            message = req.content;
            headers = req.headers;
        } else {
            message = req;
        }
        _ = check self.grpcClient->executeSimpleRPC("v0_2_0.Telemetry/publishTraces", message, headers);
    }

    isolated remote function publishTracesContext(TracesPublishRequest|ContextTracesPublishRequest req) returns empty:ContextNil|grpc:Error {
        map<string|string[]> headers = {};
        TracesPublishRequest message;
        if req is ContextTracesPublishRequest {
            message = req.content;
            headers = req.headers;
        } else {
            message = req;
        }
        var payload = check self.grpcClient->executeSimpleRPC("v0_2_0.Telemetry/publishTraces", message, headers);
        [anydata, map<string|string[]>] [_, respHeaders] = payload;
        return {headers: respHeaders};
    }
}

public client class TelemetryNilCaller {
    private grpc:Caller caller;

    public isolated function init(grpc:Caller caller) {
        self.caller = caller;
    }

    public isolated function getId() returns int {
        return self.caller.getId();
    }

    isolated remote function sendError(grpc:Error response) returns grpc:Error? {
        return self.caller->sendError(response);
    }

    isolated remote function complete() returns grpc:Error? {
        return self.caller->complete();
    }

    public isolated function isCancelled() returns boolean {
        return self.caller.isCancelled();
    }
}

public type ContextTracesPublishRequest record {|
    TracesPublishRequest content;
    map<string|string[]> headers;
|};

public type ContextMetricsPublishRequest record {|
    MetricsPublishRequest content;
    map<string|string[]> headers;
|};

public type TraceSpan record {|
    string traceId = "";
    string spanId = "";
    string serviceName = "";
    string operationName = "";
    int timestamp = 0;
    int duration = 0;
    TraceSpanReference[] references = [];
    Checkpoint[] checkpoints = [];
    record {|string key; string value;|}[] tags = [];
|};

public type Checkpoint record {|
    int timestamp = 0;
    string moduleID = "";
    string positionID = "";
|};

public type TracesPublishRequest record {|
    TraceSpan[] spans = [];
    string observabilityId = "";
    string 'version = "";
    string nodeId = "";
    string projectSecret = "";
|};

public type TraceSpanReference record {|
    string traceId = "";
    string spanId = "";
    TraceReferenceType refType = CHILD_OF;
|};

public type Metric record {|
    int timestamp = 0;
    string name = "";
    float value = 0.0;
    record {|string key; string value;|}[] tags = [];
|};

public type MetricsPublishRequest record {|
    Metric[] metrics = [];
    string observabilityId = "";
    string 'version = "";
    string nodeId = "";
    string projectSecret = "";
|};

public enum TraceReferenceType {
    CHILD_OF,
    FOLLOWS_FROM
}

const string ROOT_DESCRIPTOR_TELEMETRY = "0A0F74656C656D657472792E70726F746F120676305F325F301A1B676F6F676C652F70726F746F6275662F656D7074792E70726F746F22C3010A154D6574726963735075626C6973685265717565737412280A076D65747269637318012003280B320E2E76305F325F302E4D657472696352076D65747269637312280A0F6F62736572766162696C6974794964180220012809520F6F62736572766162696C697479496412180A0776657273696F6E180320012809520776657273696F6E12160A066E6F6465496418042001280952066E6F6465496412240A0D70726F6A656374536563726574180520012809520D70726F6A65637453656372657422B7010A064D6574726963121C0A0974696D657374616D70180120012803520974696D657374616D7012120A046E616D6518022001280952046E616D6512140A0576616C7565180320012801520576616C7565122C0A047461677318042003280B32182E76305F325F302E4D65747269632E54616773456E7472795204746167731A370A0954616773456E74727912100A036B657918012001280952036B657912140A0576616C7565180220012809520576616C75653A02380122C1010A145472616365735075626C6973685265717565737412270A057370616E7318012003280B32112E76305F325F302E54726163655370616E52057370616E7312280A0F6F62736572766162696C6974794964180220012809520F6F62736572766162696C697479496412180A0776657273696F6E180320012809520776657273696F6E12160A066E6F6465496418042001280952066E6F6465496412240A0D70726F6A656374536563726574180520012809520D70726F6A656374536563726574229B030A0954726163655370616E12180A077472616365496418012001280952077472616365496412160A067370616E496418022001280952067370616E496412200A0B736572766963654E616D65180320012809520B736572766963654E616D6512240A0D6F7065726174696F6E4E616D65180420012809520D6F7065726174696F6E4E616D65121C0A0974696D657374616D70180520012803520974696D657374616D70121A0A086475726174696F6E18062001280352086475726174696F6E122F0A047461677318072003280B321B2E76305F325F302E54726163655370616E2E54616773456E747279520474616773123A0A0A7265666572656E63657318082003280B321A2E76305F325F302E54726163655370616E5265666572656E6365520A7265666572656E63657312340A0B636865636B706F696E747318092003280B32122E76305F325F302E436865636B706F696E74520B636865636B706F696E74731A370A0954616773456E74727912100A036B657918012001280952036B657912140A0576616C7565180220012809520576616C75653A023801227C0A1254726163655370616E5265666572656E636512180A077472616365496418012001280952077472616365496412160A067370616E496418022001280952067370616E496412340A077265665479706518032001280E321A2E76305F325F302E54726163655265666572656E63655479706552077265665479706522660A0A436865636B706F696E74121C0A0974696D657374616D70180120012803520974696D657374616D70121A0A086D6F64756C65494418022001280952086D6F64756C654944121E0A0A706F736974696F6E4944180320012809520A706F736974696F6E49442A340A1254726163655265666572656E636554797065120C0A084348494C445F4F46100012100A0C464F4C4C4F57535F46524F4D1001329B010A0954656C656D6574727912470A0E7075626C6973684D657472696373121D2E76305F325F302E4D6574726963735075626C697368526571756573741A162E676F6F676C652E70726F746F6275662E456D70747912450A0D7075626C697368547261636573121C2E76305F325F302E5472616365735075626C697368526571756573741A162E676F6F676C652E70726F746F6275662E456D70747942360A346F72672E62616C6C6572696E616C616E672E6F6273657276652E74726163652E657874656E73696F6E2E63686F72656F2E67656E620670726F746F33";

public isolated function getDescriptorMapTelemetry() returns map<string> {
    return {"google/protobuf/empty.proto": "0A1B676F6F676C652F70726F746F6275662F656D7074792E70726F746F120F676F6F676C652E70726F746F62756622070A05456D70747942540A13636F6D2E676F6F676C652E70726F746F627566420A456D70747950726F746F50015A057479706573F80101A20203475042AA021E476F6F676C652E50726F746F6275662E57656C6C4B6E6F776E5479706573620670726F746F33", "telemetry.proto": "0A0F74656C656D657472792E70726F746F120676305F325F301A1B676F6F676C652F70726F746F6275662F656D7074792E70726F746F22C3010A154D6574726963735075626C6973685265717565737412280A076D65747269637318012003280B320E2E76305F325F302E4D657472696352076D65747269637312280A0F6F62736572766162696C6974794964180220012809520F6F62736572766162696C697479496412180A0776657273696F6E180320012809520776657273696F6E12160A066E6F6465496418042001280952066E6F6465496412240A0D70726F6A656374536563726574180520012809520D70726F6A65637453656372657422B7010A064D6574726963121C0A0974696D657374616D70180120012803520974696D657374616D7012120A046E616D6518022001280952046E616D6512140A0576616C7565180320012801520576616C7565122C0A047461677318042003280B32182E76305F325F302E4D65747269632E54616773456E7472795204746167731A370A0954616773456E74727912100A036B657918012001280952036B657912140A0576616C7565180220012809520576616C75653A02380122C1010A145472616365735075626C6973685265717565737412270A057370616E7318012003280B32112E76305F325F302E54726163655370616E52057370616E7312280A0F6F62736572766162696C6974794964180220012809520F6F62736572766162696C697479496412180A0776657273696F6E180320012809520776657273696F6E12160A066E6F6465496418042001280952066E6F6465496412240A0D70726F6A656374536563726574180520012809520D70726F6A656374536563726574229B030A0954726163655370616E12180A077472616365496418012001280952077472616365496412160A067370616E496418022001280952067370616E496412200A0B736572766963654E616D65180320012809520B736572766963654E616D6512240A0D6F7065726174696F6E4E616D65180420012809520D6F7065726174696F6E4E616D65121C0A0974696D657374616D70180520012803520974696D657374616D70121A0A086475726174696F6E18062001280352086475726174696F6E122F0A047461677318072003280B321B2E76305F325F302E54726163655370616E2E54616773456E747279520474616773123A0A0A7265666572656E63657318082003280B321A2E76305F325F302E54726163655370616E5265666572656E6365520A7265666572656E63657312340A0B636865636B706F696E747318092003280B32122E76305F325F302E436865636B706F696E74520B636865636B706F696E74731A370A0954616773456E74727912100A036B657918012001280952036B657912140A0576616C7565180220012809520576616C75653A023801227C0A1254726163655370616E5265666572656E636512180A077472616365496418012001280952077472616365496412160A067370616E496418022001280952067370616E496412340A077265665479706518032001280E321A2E76305F325F302E54726163655265666572656E63655479706552077265665479706522660A0A436865636B706F696E74121C0A0974696D657374616D70180120012803520974696D657374616D70121A0A086D6F64756C65494418022001280952086D6F64756C654944121E0A0A706F736974696F6E4944180320012809520A706F736974696F6E49442A340A1254726163655265666572656E636554797065120C0A084348494C445F4F46100012100A0C464F4C4C4F57535F46524F4D1001329B010A0954656C656D6574727912470A0E7075626C6973684D657472696373121D2E76305F325F302E4D6574726963735075626C697368526571756573741A162E676F6F676C652E70726F746F6275662E456D70747912450A0D7075626C697368547261636573121C2E76305F325F302E5472616365735075626C697368526571756573741A162E676F6F676C652E70726F746F6275662E456D70747942360A346F72672E62616C6C6572696E616C616E672E6F6273657276652E74726163652E657874656E73696F6E2E63686F72656F2E67656E620670726F746F33"};
}

